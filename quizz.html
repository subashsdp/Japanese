<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana/Katakana/Kanji Quiz</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.24.0/dist/bootstrap-table.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #f7c0ec, #a7bdea);
            height: 100vh;
            background-size: cover;
            /* Ensures the gradient covers the entire viewport */
            background-repeat: no-repeat;
            /* Prevents repeating */
            background-attachment: fixed;
        }


        .quiz-app {
            margin: 0 auto;
            padding: 25px 0px 0px 0px;
            border-radius: 10px;
            width: 800px;
        }

        .quiz-app #quiz-container,
        #input-container {
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            width: 600px;
        }

        h3 {
            font-size: 5rem;
        }

        button {
            margin: 10px 5px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            position: relative;
        }

        #input-container {
            display: block;
            margin-bottom: 20px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 1.25rem;
            font-weight: bold;
        }

        /* Spin effect and meaning display */
        .option {
            display: inline-block;
            width: 150px;
            text-align: center;
            background-color: #e5e8eb;
            font-size: 1.25rem;
            text-transform: uppercase;
        }

        /* .option .meaning {
            display: none;
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px;
            border-radius: 5px;
        } */

        /* .option:hover .meaning {
            display: block;
        } */

        .hiraganasubgrp {
            display: inline !important;
        }

        .hiraganasubgrp label {
            padding: 0px 10px;
            margin: 5px 1px;
            border-radius: 15px;
            font-size: 0.90rem
        }

        .custom-radio-label {
            background-color: white;
            /* Unchecked background */
            transition: background-color 0.3s, color 0.3s;
            /* Smooth transition */
        }

        .btn-check:checked+.custom-radio-label {
            background-color: #0d6efd;
            /* Primary color when checked */
            color: white;
            /* Text color when checked */
        }

        .btn-check:not(:checked)+.custom-radio-label:hover {
            background-color: white;
            /* Light gray for hover */
            color: #0d6efd;
            /* Retain text color on hover */
        }

        /* New styles for Kanji Flashcards */
        .kanji-flashcard-container {
            display: grid;
            grid-template-columns: repeat(5, minmax(115px, 1fr));
            /* Automatically adjust columns */
            gap: 20px;
            margin-top: 20px;
            padding: 0 10px;
            width: 100%;
            /* Ensure full width utilization */
            box-sizing: border-box;
            /* Prevent overflow */
        }

        .kanji-card {
            width: 100%;
            height: 150px;
            background-color: #ffffff;
            border: 2px solid #0d6efd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
            user-select: none;
            /* Disable text selection */
            -webkit-user-select: none;
            /* Safari */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
            /* Prevent content overflow */
        }

        .kanji-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            background-color: #0d6efd;
        }

        .kanji-card-header {
            font-size: 45px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        .kanji-card:hover .kanji-card-header,
        .kanji-card:hover .kanji-romaji,
        .kanji-card:hover .kanji-meaning {
            color: white;
        }

        .kanji-card-body {
            text-align: center;
        }

        .kanji-romaji {
            font-size: 16px;
            color: #0d6efd;
            font-weight: bold;
            text-transform: uppercase;
        }

        .kanji-meaning {
            font-size: 14px;
            color: #555;
            text-align: center;
        }

        @media (max-width: 1024px) {
            .accordion-body {
                max-height: 800px;
                /* Reduce height for tablets */
            }
        }

        @media (max-width: 1180px) {
            .accordion-body {
                max-height: 450px;
                /* Reduce height for tablets */
            }
        }

        /* Responsive layout for small screens */
        @media (max-width: 768px) {
            .kanji-flashcard-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                /* For smaller screens */
            }

            .kanji-card-header {
                font-size: 45px;
                /* Adjust font size for small screens */
            }

            .accordion-body {
                max-height: 900px;
                /* Reduce height further for mobiles */
            }
        }

        @media (max-width: 480px) {
            .kanji-flashcard-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                /* For very small screens */
            }

            .kanji-card-header {
                font-size: 25px;
                /* Adjust font size further for tiny screens */
            }

            .kanji-card-body {
                font-size: 12px;
                /* Reduce font size for better readability on very small screens */
            }
        }

        .accordion-header button {
            margin: 10px 0px;
        }

        .accordion-button:not(.collapsed) {
            color: #0d6efd !important;
            background-color: none !important;
            box-shadow: none !important;
        }

        .accordion {
            --bs-accordion-border-color: none !important
        }

        .accordion-button:focus {
            --bs-accordion-border-color: none !important;
            border: none !important;
            --bs-accordion-btn-focus-border-color: none !important
        }

        .accordion-collapse {
            transition: 0.7s ease-in-out;
        }

        .toggle-pronunciation-container {
            margin-top: 10px;
            position: relative;
            text-align: right;
            /* Aligns the button to the right */
        }

        .toggle-pronunciation {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
        }

        .toggle-pronunciation i {
            font-size: 16px;
            /* Adjust the icon size as needed */
        }

        .circular-chart {
            display: inline-block;
            max-width: 100px;
            max-height: 100px;
        }

        .circle-bg {
            fill: none;
            stroke: #eee;
            stroke-width: 3.8;
        }

        .circle {
            fill: none;
            stroke-width: 2.8;
            stroke: #4caf50;
            stroke-linecap: round;
            animation: progress 1s ease-out forwards;
        }

        .percentage {
            font-size: 0.5em;
            text-anchor: middle;
            fill: #4caf50;
            font-weight: bold;
        }

        @keyframes progress {
            0% {
                stroke-dasharray: 0, 100;
            }
        }

        .meaningClass {
            font-size: 0.6em;
            /* color: #666; */
            /* A duller color */
            margin-top: 5px;
            display: block;
            /* Ensure it appears on a new line */
        }

        .options .btn-danger .meaningClass {
            color: white
        }

        .accordion-body {
            overflow-y: auto;
        }

        .quizTableDiv {
            width: 800px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <div class="quiz-app">
        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="page-type" id="btnradio111" autocomplete="off" checked
                onclick=onclick_pagetype_radio(1)>
            <label class="btn btn-outline-primary custom-radio-label" for="btnradio111">Quiz</label>

            <input type="radio" class="btn-check" name="page-type" id="btnradio112" autocomplete="off"
                onclick=onclick_pagetype_radio(2)>
            <label class="btn btn-outline-primary custom-radio-label" for="btnradio112">Reference</label>

            <input type="radio" class="btn-check" name="page-type" id="btnradio113" autocomplete="off"
                onclick=onclick_pagetype_radio(3)>
            <label class="btn btn-outline-primary custom-radio-label" for="btnradio113">History</label>
        </div>
        <br><br>
        <div id="input-container" class="card">
            <div class="card-header">Select Quiz Type and Number of Questions</div>
            <div class="card-body">

                <p>Select Quiz Type:</p>
                <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                    <input type="radio" class="btn-check" name="quiz-type" id="btnradio1" autocomplete="off" checked
                        onclick=onclick_language_radio(1)>
                    <label class="btn btn-outline-primary" for="btnradio1">Hiragana</label>

                    <input type="radio" class="btn-check" name="quiz-type" id="btnradio2" autocomplete="off"
                        onclick=onclick_language_radio(2)>
                    <label class="btn btn-outline-primary" for="btnradio2">Katakana</label>

                    <input type="radio" class="btn-check" name="quiz-type" id="btnradio3" autocomplete="off"
                        onclick=onclick_language_radio(3)>
                    <label class="btn btn-outline-primary" for="btnradio3">Kanji</label>
                </div>
                <br><br>
                <div id="hiraganasubmenu">
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio11" autocomplete="off"
                            checked>
                        <label class="btn btn-outline-primary" for="btnradio11">Basic</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio12"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio12">With Tenten</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio13"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio13">With Maru</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio14"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio14">Combination without Tenten</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio15"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio15">Combination with Tenten</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio16"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio16">Combination with Maru</label>
                    </div>
                    <div class="hiraganasubgrp">
                        <input type="checkbox" class="btn-check" name="hiragana-type" id="btnradio17"
                            autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio17">All</label>
                    </div>

                </div>

                <br><br>
                <div class="row">
                    <div class="col">
                        <label for="num-questions">Number of Questions: </label>
                        <input type="number" id="num-questions" class="form-control" min="1" value="5">
                    </div>
                    <br>
                    <div class="col">
                        <label for="timerInput">Set Timer (seconds):</label>
                        <input type="number" id="timerInput" class="form-control" min="5" max="30" value="5">
                    </div>
                </div>
                <br>
                <div class="d-grid gap-2">
                    <button id="start-quiz" class="btn btn-primary">Start Quiz</button>
                </div>
            </div>
        </div>
        <div id="quiz-container"></div>

        <div class="accordion" id="accordionExample"></div>


    </div>
    <div>
        <div class="container quizTableDiv" id="quizTableDiv">
            <table id="quizTable" class="table table-bordered table-striped" data-search="true" data-sortable="true"
                data-pagination="true">
                <thead class="table-light">
                    <tr>
                        <th data-field="quiztype" data-sortable="true">Quiz Type</th>
                        <th data-field="character" data-sortable="true">Character</th>
                        <th data-field="romaji" data-sortable="true">Romaji</th>
                        <th data-field="answered" data-sortable="true">Answered</th>
                        <th data-field="trailcount" data-sortable="true">Trail Count</th>
                        <th data-field="status" data-sortable="true">Status</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.js"></script>
    <script>
        let quizType = "";
        let flashcards = [];
        let shuffledFlashcards = [];
        let hiraganaType = [];
        let currentQuestion = 0;
        let score = 0;
        let totalQuestions = 5;  // Default number of questions
        let timer;
        let timeLeft = 0; // 10 seconds for each question
        let pagevalue = 1;
        let history_dataset = []
        let databindonreference = 0;
        let trailcount = 0;


        function shuffleArray(array) {

            return array.sort(() => Math.random() - 0.5);
        }

        function generateOptions(correctAnswer) {

            const options = new Set([correctAnswer]);
            const meanings = {};  // Store the meaning for each romaji
            // Add meanings to the options set
            while (options.size < Math.min(flashcards.length, 6)) {
                const randomOption = flashcards[Math.floor(Math.random() * flashcards.length)].romaji;
                options.add(randomOption);
            }
            shuffleArray([...options]);
            // Prepare the meanings map
            flashcards.forEach(flashcard => {
                meanings[flashcard.romaji] = flashcard.meaning || ''; // Store meaning for each romaji
            });
            if (quizType === "Kanji") {
                return shuffleArray([...options]).map(option => {
                    const meaning = meanings[option] || '';
                    // return `<button class="option btn btn-light"  data-bs-toggle="tooltip" data-bs-title="${meaning}" >${option}</button>`;
                    return `<button class="option btn btn-light">${option}<span class="invisible">|</span><span class="meaningClass">${meaning}</span></button>`;
                }).join('');
            }
            else {

                return shuffleArray([...options]).map(option => {
                    return `<button class="option btn btn-light">${option}</button>`;
                }).join('');
            }
            // Convert Set to array and shuffle the options

        }

        function renderQuiz() {

            const $container = $('#quiz-container');
            if (currentQuestion >= totalQuestions) {
                clearInterval(timer); // Stop the timer when the quiz ends
                $container.html(`
            <div class="card"  id="quiz_card">
                <div class="card-header">Your Score</div>
                <div class="card-body text-center">
                    <svg height="120" width="120" viewBox="0 0 36 36" class="circular-chart green">
                        <path class="circle-bg" d="M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" stroke-dasharray="${score / (totalQuestions / 100)}, 100" d="M18 2.0845
                        a 15.9155 15.9155 0 0 1 0 31.831
                        a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage">${Math.round((score) / (totalQuestions / 100))}%</text>
                    </svg>
                    <br>
                    <h3>${score} / ${totalQuestions}</h3>
                    <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="retryQuiz(1)">Retry Quiz</button>
                    </div>
                </div>
            </div>
        `);
                if (score == totalQuestions && totalQuestions > 0) {
                    var duration = 3 * 1000;
                    var animationEnd = Date.now() + duration;
                    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

                    function randomInRange(min, max) {
                        return Math.random() * (max - min) + min;
                    }

                    var interval = setInterval(function () {
                        var timeLeft = animationEnd - Date.now();

                        if (timeLeft <= 0) {
                            return clearInterval(interval);
                        }

                        var particleCount = 50 * (timeLeft / duration);
                        // since particles fall down, start a bit higher than random
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
                    }, 250);
                }
                return;
            }

            const currentCharacter = shuffledFlashcards[currentQuestion];
            const optionsHtml = generateOptions(currentCharacter.romaji);
            const percentage = (currentQuestion) / (totalQuestions / 100);
            $container.html(`
        <div class="card" id="quiz_card">
            <div class="card-header">
                Question ${currentQuestion + 1} / ${totalQuestions}
                <div id="timer" class="float-end">Time Left: ${timeLeft} seconds</div>
            </div>
            <div class="card-body">
                <h3>${currentCharacter.character}</h3>
                <div id="options-container">${optionsHtml}</div>
            </div>
            <br><br>
            <div class="d-grid gap-2">
                <button class="btn btn-danger" type="button" onclick="stopQuiz()">STOP</button>
            </div>
            <div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="${currentQuestion + 1}" aria-valuemin="0" aria-valuemax="${totalQuestions}">
                <div class="progress-bar" style="width: ${percentage}%"></div>
            </div>
        </div>
    `);
            startTimer(); // Start the timer for the current question
        }
        function startTimer() {

            clearInterval(timer); // Clear any existing timer
            timeLeft = parseInt($('#timerInput').val(), 10); // Get value from user input
            if (isNaN(timeLeft) || timeLeft <= 0) {
                timeLeft = 10; // Default to 10 seconds if input is invalid
            }

            $('#timer').text(`Time Left: ${timeLeft} seconds`);

            timer = setInterval(() => {
                timeLeft--;
                $('#timer').text(`Time Left: ${timeLeft} seconds`);

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    currentQuestion++; // Automatically move to the next question
                    renderQuiz();
                }
            }, 1000); // Decrement every second
        }



        function handleAnswerOptionClick(option) {
            debugger
            clearInterval(timer); // Stop the timer when an option is selected

            const currentCharacter = shuffledFlashcards[currentQuestion];
            let status = currentCharacter.romaji === option ? "Correct" : "Incorrect";
            let new_arr = { "quiztype": quizType, "trailcount": trailcount, "character": currentCharacter.character, "romaji": currentCharacter.romaji, "answered": option, "status": status };
            history_dataset.push(new_arr);
            adddatatohistorytable(new_arr);
            const $optionsContainer = $('#options-container');

            $optionsContainer.children().each(function () {
                const $button = $(this);
                const isCorrect = $button.text().split('|')[0] === currentCharacter.romaji;

                // Add correct/incorrect class based on the answer
                if (isCorrect) {
                    $button.removeClass('btn-light').addClass('btn-success');
                } else {
                    $button.removeClass('btn-light').addClass('btn-danger');
                }

                $button.prop('disabled', true); // Disable all options after selection
            });

            // Increase score if the answer is correct
            if (option === currentCharacter.romaji) {
                score++;
            }

            setTimeout(() => {
                currentQuestion++;
                renderQuiz();
            }, 1500); // Pause for 1 second before moving to the next question
        }


        function retryQuiz(value) {
            clearInterval(timer); // Stop the timer
            shuffledFlashcards = shuffleArray([...flashcards]);
            currentQuestion = 0;
            score = 0;
            hiraganaType = [];
            if (value == 1) {
                $('#input-container').slideDown();
                $('#quiz-container').slideUp();
            }
        }

        function getSelectedRadioValue() {

            const radios = document.querySelectorAll('input[name="quiz-type"]');
            let selectedValue = null;

            radios.forEach((radio) => {
                if (radio.checked) {

                    // Get the associated label text
                    const label = document.querySelector(`label[for="${radio.id}"]`);
                    selectedValue = label ? label.textContent : null;
                }
            });

            return selectedValue;
        }
        function getSelectedKanjiValue() {

            const checkboxes = document.querySelectorAll('input[name="hiragana-type"]');
            let selectedValue = null;
            checkboxes.forEach((ck) => {
                if (ck.checked) {
                    // Get the associated label text
                    const label = document.querySelector(`label[for="${ck.id}"]`);
                    selectedValue = label ? label.textContent : null;
                    hiraganaType.push(selectedValue);
                }
            });
            return hiraganaType;
        }
        function startQuiz() {

            const numQuestions = parseInt($('#num-questions').val(), 10);
            const timerDuration = parseInt($('#timerInput').val(), 10);

            // Validate the inputs
            if (isNaN(numQuestions) || numQuestions < 1) {
                alert('Please enter a valid number of questions.');
                return;
            }
            if (isNaN(timerDuration) || timerDuration < 5 || timerDuration > 30) {
                alert('Please enter a valid timer duration between 5 and 30 seconds.');
                return;
            }

            // Set up quiz with these values
            totalQuestions = numQuestions;
            timeLeft = timerDuration;


            totalQuestions = parseInt($('#num-questions').val());
            quizType = getSelectedRadioValue();

            flashcards = []
            // Set the flashcards based on the quiz type
            switch (quizType) {
                case 'Hiragana':
                    hiraganaType = getSelectedKanjiValue();
                    if (hiraganaType.length == 0) {
                        alert(`Please select minimum one Hiragana Type`);
                        return;
                    } else {
                        //flashcards = hiraganaFlashcards;
                        if (hiraganaType.includes('All') || hiraganaType.includes('Basic')) {
                            flashcards.push(...hiraganaFlashcards.Basic.filter(a => a.character != '-'))
                        }
                        if (hiraganaType.includes('All') || hiraganaType.includes('With Tenten')) {
                            flashcards.push(...hiraganaFlashcards.With_Tenten.filter(a => a.character != '-'))
                        }
                        if (hiraganaType.includes('All') || hiraganaType.includes('With Maru')) {
                            flashcards.push(...hiraganaFlashcards.With_Maru.filter(a => a.character != '-'))
                        }
                        if (hiraganaType.includes('All') || hiraganaType.includes('Combination without Tenten')) {
                            flashcards.push(...hiraganaFlashcards.Combination_without_Tenten.filter(a => a.character != '-'))
                        }
                        if (hiraganaType.includes('All') || hiraganaType.includes('Combination with Tenten')) {
                            flashcards.push(...hiraganaFlashcards.Combination_with_Tenten.filter(a => a.character != '-'))
                        }
                        if (hiraganaType.includes('All') || hiraganaType.includes('Combination with Maru')) {
                            flashcards.push(...hiraganaFlashcards.Combination_with_Maru.filter(a => a.character != '-'))
                        }
                    }
                    break;
                case 'Katakana':
                    flashcards = katakanaFlashcards;
                    break;
                case 'Kanji':
                    flashcards = kanjiFlashcards;
                    break;
            }

            const maxQuestions = flashcards.length;

            // Validate the number of questions
            if (totalQuestions < 1 || totalQuestions > maxQuestions) {
                alert(`Please choose a number between 1 and ${maxQuestions}.`);
                return;
            }

            shuffledFlashcards = shuffleArray([...flashcards]);
            currentQuestion = 0;
            score = 0;
            hiraganaType = [];
            trailcount++;
            $('#input-container').slideUp();
            $('#quiz-container').slideDown();
            renderQuiz();
        }

        $(document).ready(function () {
            $('#start-quiz').on('click', startQuiz);
            $('#quizTableDiv').hide();
            $(document).on('click', '#options-container .option', function () {

                const option = $(this).text();

                handleAnswerOptionClick(option.split('|')[0]);
            });

            $('#btnradio17').change(function () {
                const isChecked = $(this).is(':checked');
                // Check or uncheck all checkboxes except the "All" checkbox
                $('input[name="hiragana-type"]').not(this).prop('checked', isChecked);
            });

            // Update the "All" checkbox state
            $('input[name="hiragana-type"]').not('#btnradio17').change(function () {
                const allChecked = $('input[name="hiragana-type"]:not(#btnradio17)').length ===
                    $('input[name="hiragana-type"]:not(#btnradio17):checked').length;
                $('#btnradio17').prop('checked', allChecked);
            });

            let key = 'history_quiz'
            if (sessionStorage.getItem(key) !== null) {
                console.log("Key already exists with value:", sessionStorage.getItem(key));
                let dataset = JSON.parse(sessionStorage.getItem(key))
                if (dataset.length > 0 && history_dataset.length == 0) {
                    history_dataset = dataset;
                }
            }
            debugger
            let grp = Object.groupBy((history_dataset.filter(a => a.status != 'Correct')), ({ romaji }) => romaji)
            let new_dataset = [];
            Object.entries(grp).map(([key, value]) => {
                new_dataset.push({
                    quiztype: value[0].quiztype,
                    trailcount: value.length,
                    character: value[0].character,
                    romaji: value[0].romaji,
                    answered: value[0].answered,
                    status: value[0].status
                });
            });
            $('#quizTable').bootstrapTable({ data: new_dataset })
        });
        function stopQuiz() {
            onclick_pagetype_radio(1);
        }
        function onclick_language_radio(value) {

            if (value == 1) {
                $('#hiraganasubmenu').slideDown();
            }
            else {
                $('#hiraganasubmenu').slideUp();
            }
        }
        function onclick_pagetype_radio(value) {
            debugger
            if (value == 1) {
                pagevalue = value;
                $('#input-container').slideDown();
                $('#quiz-container').slideUp();
                $('#accordionExample').slideUp();
                $('#quizTableDiv').slideUp();
                retryQuiz(2)
            } else if (value == 2) {
                if (databindonreference == 0) {
                    renderFlashcards();
                }
                retryQuiz(2)
                $('#quiz-container').slideUp();
                $('#input-container').slideUp();
                $('#quizTableDiv').slideUp();
                $('#accordionExample').slideDown();
            } else if (value == 3) {
                $('#quiz-container').slideUp();
                $('#input-container').slideUp();
                $('#accordionExample').slideUp();
                $('#quizTableDiv').slideDown();
            }
        }

        const katakanaFlashcards = [{ character: "ア", romaji: "a" }, { character: "イ", romaji: "i" }, { character: "ウ", romaji: "u" }, { character: "エ", romaji: "e" }, { character: "オ", romaji: "o" }, { character: "カ", romaji: "ka" }, { character: "キ", romaji: "ki" }, { character: "ク", romaji: "ku" }, { character: "ケ", romaji: "ke" }, { character: "コ", romaji: "ko" }, { character: "サ", romaji: "sa" }, { character: "シ", romaji: "shi" }, { character: "ス", romaji: "su" }, { character: "セ", romaji: "se" }, { character: "ソ", romaji: "so" }, { character: "タ", romaji: "ta" }, { character: "チ", romaji: "chi" }, { character: "ツ", romaji: "tsu" }, { character: "テ", romaji: "te" }, { character: "ト", romaji: "to" }, { character: "ナ", romaji: "na" }, { character: "ニ", romaji: "ni" }, { character: "ヌ", romaji: "nu" }, { character: "ネ", romaji: "ne" }, { character: "ノ", romaji: "no" }, { character: "ハ", romaji: "ha" }, { character: "ヒ", romaji: "hi" }, { character: "フ", romaji: "fu" }, { character: "ヘ", romaji: "he" }, { character: "ホ", romaji: "ho" }, { character: "マ", romaji: "ma" }, { character: "ミ", romaji: "mi" }, { character: "ム", romaji: "mu" }, { character: "メ", romaji: "me" }, { character: "モ", romaji: "mo" }, { character: "ヤ", romaji: "ya" }, { character: "ユ", romaji: "yu" }, { character: "ヨ", romaji: "yo" }, { character: "ラ", romaji: "ra" }, { character: "リ", romaji: "ri" }, { character: "ル", romaji: "ru" }, { character: "レ", romaji: "re" }, { character: "ロ", romaji: "ro" }, { character: "ワ", romaji: "wa" }, { character: "ヲ", romaji: "wo" }, { character: "ン", romaji: "n" }];

        const kanjiFlashcards = [{ character: "一", romaji: "ichi", meaning: "one" }, { character: "二", romaji: "ni", meaning: "two" }, { character: "三", romaji: "san", meaning: "three" }, { character: "四", romaji: "shi/yon", meaning: "four" }, { character: "五", romaji: "go", meaning: "five" }, { character: "六", romaji: "roku", meaning: "six" }, { character: "七", romaji: "shichi/nana", meaning: "seven" }, { character: "八", romaji: "hachi", meaning: "eight" }, { character: "九", romaji: "kyuu/ku", meaning: "nine" }, { character: "十", romaji: "juu", meaning: "ten" }, { character: "百", romaji: "hyaku", meaning: "hundred" }, { character: "千", romaji: "sen", meaning: "thousand" }, { character: "万", romaji: "man", meaning: "ten thousand" }, { character: "円", romaji: "en", meaning: "yen, circle" }, { character: "口", romaji: "kuchi", meaning: "mouth" }, { character: "目", romaji: "me", meaning: "eye" }, { character: "耳", romaji: "mimi", meaning: "ear" }, { character: "手", romaji: "te", meaning: "hand" }, { character: "足", romaji: "ashi", meaning: "foot, leg" }, { character: "力", romaji: "chikara", meaning: "power, strength" }, { character: "男", romaji: "otoko", meaning: "man" }, { character: "女", romaji: "onna", meaning: "woman" }, { character: "子", romaji: "ko", meaning: "child" }, { character: "山", romaji: "yama", meaning: "mountain" }, { character: "川", romaji: "kawa", meaning: "river" }, { character: "田", romaji: "ta", meaning: "rice field" }, { character: "休", romaji: "kyuu", meaning: "rest" }, { character: "先", romaji: "saki", meaning: "ahead, previous" }, { character: "生", romaji: "sei", meaning: "life, birth" }, { character: "学", romaji: "gaku", meaning: "study, learning" }, { character: "校", romaji: "kou", meaning: "school" }, { character: "書", romaji: "kaku", meaning: "write" }, { character: "読む", romaji: "yomu", meaning: "read" }, { character: "食", romaji: "taberu", meaning: "eat" }, { character: "飲", romaji: "nomu", meaning: "drink" }, { character: "行", romaji: "iku", meaning: "go" }, { character: "来", romaji: "kuru", meaning: "come" }, { character: "見", romaji: "miru", meaning: "see" }, { character: "言", romaji: "iu", meaning: "say" }, { character: "話", romaji: "hanasu", meaning: "talk, speak" }, { character: "聞", romaji: "kiku", meaning: "ask, hear" }, { character: "買", romaji: "kau", meaning: "buy" }, { character: "売", romaji: "uru", meaning: "sell" }, { character: "出", romaji: "deru", meaning: "exit, leave" }, { character: "入", romaji: "hairu", meaning: "enter" }, { character: "大", romaji: "dai/oo", meaning: "big, large" }, { character: "小", romaji: "shou", meaning: "small" }, { character: "長", romaji: "naga", meaning: "long" }, { character: "早", romaji: "haya", meaning: "early, fast" }, { character: "古", romaji: "furui", meaning: "old" }, { character: "新", romaji: "shin", meaning: "new" }, { character: "白", romaji: "shiro", meaning: "white" }, { character: "黒", romaji: "kuro", meaning: "black" }, { character: "青", romaji: "ao", meaning: "blue, green" }, { character: "赤", romaji: "aka", meaning: "red" }, { character: "色", romaji: "iro", meaning: "color" }, { character: "金", romaji: "kin", meaning: "gold, money" }, { character: "銀", romaji: "gin", meaning: "silver" }, { character: "土", romaji: "tsuchi", meaning: "earth, soil" }, { character: "天", romaji: "ten", meaning: "heaven" }, { character: "雨", romaji: "ame", meaning: "rain" }, { character: "電", romaji: "den", meaning: "electricity" }, { character: "車", romaji: "kuruma", meaning: "car, vehicle" }, { character: "音", romaji: "on", meaning: "sound" }, { character: "楽", romaji: "raku", meaning: "music, comfort" }, { character: "校", romaji: "kou", meaning: "school" }];

        const hiraganaFlashcards = { "Basic": [{ "character": "あ", "romaji": "a" }, { "character": "い", "romaji": "i" }, { "character": "う", "romaji": "u" }, { "character": "え", "romaji": "e" }, { "character": "お", "romaji": "o" }, { "character": "か", "romaji": "ka" }, { "character": "き", "romaji": "ki" }, { "character": "く", "romaji": "ku" }, { "character": "け", "romaji": "ke" }, { "character": "こ", "romaji": "ko" }, { "character": "さ", "romaji": "sa" }, { "character": "し", "romaji": "shi" }, { "character": "す", "romaji": "su" }, { "character": "せ", "romaji": "se" }, { "character": "そ", "romaji": "so" }, { "character": "た", "romaji": "ta" }, { "character": "ち", "romaji": "chi" }, { "character": "つ", "romaji": "tsu" }, { "character": "て", "romaji": "te" }, { "character": "と", "romaji": "to" }, { "character": "な", "romaji": "na" }, { "character": "に", "romaji": "ni" }, { "character": "ぬ", "romaji": "nu" }, { "character": "ね", "romaji": "ne" }, { "character": "の", "romaji": "no" }, { "character": "は", "romaji": "ha" }, { "character": "ひ", "romaji": "hi" }, { "character": "ふ", "romaji": "fu" }, { "character": "へ", "romaji": "he" }, { "character": "ほ", "romaji": "ho" }, { "character": "ま", "romaji": "ma" }, { "character": "み", "romaji": "mi" }, { "character": "む", "romaji": "mu" }, { "character": "め", "romaji": "me" }, { "character": "も", "romaji": "mo" }, { "character": "や", "romaji": "ya" }, { "character": "-", "romaji": "-" }, { "character": "ゆ", "romaji": "yu" }, { "character": "-", "romaji": "-" }, { "character": "よ", "romaji": "yo" }, { "character": "ら", "romaji": "ra" }, { "character": "り", "romaji": "ri" }, { "character": "る", "romaji": "ru" }, { "character": "れ", "romaji": "re" }, { "character": "ろ", "romaji": "ro" }, { "character": "わ", "romaji": "wa" }, { "character": "-", "romaji": "-" }, { "character": "を", "romaji": "wo" }, { "character": "-", "romaji": "-" }, { "character": "ん", "romaji": "n" }], "With_Tenten": [{ "character": "が", "romaji": "ga" }, { "character": "ぎ", "romaji": "gi" }, { "character": "ぐ", "romaji": "gu" }, { "character": "げ", "romaji": "ge" }, { "character": "ご", "romaji": "go" }, { "character": "ざ", "romaji": "za" }, { "character": "じ", "romaji": "ji" }, { "character": "ず", "romaji": "zu" }, { "character": "ぜ", "romaji": "ze" }, { "character": "ぞ", "romaji": "zo" }, { "character": "だ", "romaji": "da" }, { "character": "ぢ", "romaji": "ji" }, { "character": "づ", "romaji": "zu" }, { "character": "で", "romaji": "de" }, { "character": "ど", "romaji": "do" }, { "character": "ば", "romaji": "ba" }, { "character": "び", "romaji": "bi" }, { "character": "ぶ", "romaji": "bu" }, { "character": "べ", "romaji": "be" }, { "character": "ぼ", "romaji": "bo" }], "With_Maru": [{ "character": "ぱ", "romaji": "pa" }, { "character": "ぴ", "romaji": "pi" }, { "character": "ぷ", "romaji": "pu" }, { "character": "ぺ", "romaji": "pe" }, { "character": "ぽ", "romaji": "po" }], "Combination_without_Tenten": [{ "character": "-", "romaji": "-" }, { "character": "きゃ", "romaji": "kya" }, { "character": "きゅ", "romaji": "kyu" }, { "character": "きょ", "romaji": "kyo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "しゃ", "romaji": "sha" }, { "character": "しゅ", "romaji": "shu" }, { "character": "しょ", "romaji": "sho" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "ちゃ", "romaji": "cha" }, { "character": "ちゅ", "romaji": "chu" }, { "character": "ちょ", "romaji": "cho" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "にゃ", "romaji": "nya" }, { "character": "にゅ", "romaji": "nyu" }, { "character": "にょ", "romaji": "nyo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "ひゃ", "romaji": "hya" }, { "character": "ひゅ", "romaji": "hyu" }, { "character": "ひょ", "romaji": "hyo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "みゃ", "romaji": "mya" }, { "character": "みゅ", "romaji": "myu" }, { "character": "みょ", "romaji": "myo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "りゃ", "romaji": "rya" }, { "character": "りゅ", "romaji": "ryu" }, { "character": "りょ", "romaji": "ryo" }, { "character": "-", "romaji": "-" }], "Combination_with_Tenten": [{ "character": "-", "romaji": "-" }, { "character": "ぎゃ", "romaji": "gya" }, { "character": "ぎゅ", "romaji": "gyu" }, { "character": "ぎょ", "romaji": "gyo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "じゃ", "romaji": "ja" }, { "character": "じゅ", "romaji": "ju" }, { "character": "じょ", "romaji": "jo" }, { "character": "-", "romaji": "-" }, { "character": "-", "romaji": "-" }, { "character": "びゃ", "romaji": "bya" }, { "character": "びゅ", "romaji": "byu" }, { "character": "びょ", "romaji": "byo" }, { "character": "-", "romaji": "-" }], "Combination_with_Maru": [{ "character": "-", "romaji": "-" }, { "character": "ぴゃ", "romaji": "pya" }, { "character": "ぴゅ", "romaji": "pyu" }, { "character": "ぴょ", "romaji": "pyo" }, { "character": "-", "romaji": "-" }] }

        function renderFlashcards() {
            const accordionContainer = $('#accordionExample');
            accordionContainer.empty(); // Clear existing accordion content before rendering

            // Function to generate card HTML for any dataset
            function generateCards(flashcards, title, datasetType) {
                let cardsHtml = `
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading${title}">
                            <button
                                class="accordion-button collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#collapse${title}"
                                aria-expanded="false"
                                aria-controls="collapse${title}">
                                ${title}
                            </button>
                        </h2>
                        <div id="collapse${title}"
                            class="accordion-collapse collapse"
                            aria-labelledby="heading${title}"
                            data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                <div class="toggle-pronunciation-container text-end">
                                    <button
                                        class="btn btn-primary btn-sm toggle-pronunciation"
                                        data-target="#collapse${title}"
                                        style="display: none;">
                                        <i class="bi bi-eye-slash-fill"></i> <!-- Default state: "Hide Pronunciation" -->
                                    </button>
                                </div>
                                <div class="kanji-flashcard-container">
                    `;

                flashcards.forEach((card, index) => {
                    cardsHtml += `
                        <div class="kanji-card">
                            <div class="kanji-card-header">
                                ${card.character}
                            </div>
                            <div class="kanji-card-body">
                                <div class="kanji-romaji">${card.romaji}</div>
                                ${datasetType === 'kanji'
                            ? `<div class="kanji-meaning">${card.meaning}</div>`
                            : ''
                        }
                            </div>
                        </div>
                        `;
                });

                cardsHtml += `
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                databindonreference = 1;
                return cardsHtml;
            }

            // Render Katakana, Kanji, and Hiragana cards
            accordionContainer.append(generateCards([...hiraganaFlashcards.Basic, ...hiraganaFlashcards.With_Maru, ...hiraganaFlashcards.With_Tenten, ...hiraganaFlashcards.Combination_without_Tenten, ...hiraganaFlashcards.Combination_with_Maru, ...hiraganaFlashcards.Combination_with_Tenten], 'Hiragana', 'hiragana'));
            accordionContainer.append(generateCards(katakanaFlashcards, 'Katakana', 'katakana'));
            accordionContainer.append(generateCards(kanjiFlashcards, 'Kanji', 'kanji'));

        }

        // Ensure event is bound only once
        $(document).off('click', '.toggle-pronunciation').on('click', '.toggle-pronunciation', function () {
            const target = $(this).data('target'); // Get the target accordion
            const romajiElements = $(`${target} .kanji-romaji`); // Select kanji-romaji elements within the target

            if (romajiElements.is(':visible')) {
                romajiElements.hide(); // Hide if visible
                $(this).html('<i class="bi bi-eye-fill"></i>'); // Update button to "Show Pronunciation" icon
            } else {
                romajiElements.show(); // Show if hidden
                $(this).html('<i class="bi bi-eye-slash-fill"></i>'); // Update button to "Hide Pronunciation" icon
            }
        });

        // Accordion show/hide handlers to control button visibility
        $(document).on('show.bs.collapse', function (e) {
            const target = $(e.target); // Target accordion being opened
            const button = target.find('.toggle-pronunciation'); // Find the button inside it
            button.show(); // Show the button when accordion opens
        });

        $(document).on('hide.bs.collapse', function (e) {
            const target = $(e.target); // Target accordion being closed
            const button = target.find('.toggle-pronunciation'); // Find the button inside it
            button.hide(); // Hide the button when accordion closes
        });
        function adddatatohistorytable(item) {
            debugger
            $('#quizTable').bootstrapTable('append', [item])
            $('#quizTable').bootstrapTable('scrollTo', 'bottom')

            let key = 'history_quiz'
            if (sessionStorage.getItem(key) !== null) {
                console.log("Key already exists with value:", sessionStorage.getItem(key));
                let dataset = JSON.parse(sessionStorage.getItem(key))
                if (dataset.length > 0 && history_dataset.length == 0) {
                    history_dataset = dataset;
                }
                sessionStorage.setItem(key, JSON.stringify(history_dataset));
            } else {
                sessionStorage.setItem(key, JSON.stringify(history_dataset));
            }
        }
    </script>
</body>

</html>